  <form method="POST" action="https://formapi.fly.dev/post" id="form">
    <div class="form-group row">
      <div class="col-8">
        <div class="input-group">
          <div class="input-group-addon">
            <i class="fa fa-user"></i>
          </div>
          <input id="name" name="name" placeholder="Your name" maxlength="30" minlength="3" type="text" required="required" class="form-control">
        </div>
      </div>
    </div>
    <div class="form-group row" style="margin-top: 0.5em;">
      <div class="col-8">
        <div class="input-group">
          <div class="input-group-addon">
            <i class="fa fa-envelope"></i>
          </div>
          <input style="width: 95%;" id="email" name="email" placeholder="Email address, phone number or Telegram" maxlength="30" minlength="5" type="text" required="required" class="form-control">
        </div>
      </div>
    </div>
    <div class="form-group row" style="margin-top: 0.5em;">
      <div class="col-8">
        <textarea id="message" name="message" cols="45" rows="10" required="required" minlength="6" class="form-control" placeholder="Type your message&#10;Max 1000 character&#10;You can put here links to external resources&#10;For sending files, use the form below" maxlength="1000" spellcheck="true"></textarea>
      </div>
    </div>
    <div class="frc-captcha" style="transition: all 0.5s;margin-top: 0.2em;width: 2em;border-radius: 0.5em;border: 0.1em solid black !important;" data-sitekey="FCMTGCV10AMHV9QE"></div>
    <div class="form-group row" style="width: fit-content;margin-top: 1em;">
      <div class="offset-4 col-8" style="float: left;">
        <button name="submit" type="submit" id="submit" class="btn btn-primary">Submit</button>
      </div>
      <div id="loading"></div>
    </div>
    <p id="my-form-status"></p>
  </form>

<script
  type="module"
  src="https://cdn.jsdelivr.net/npm/friendly-challenge@0.9.16/widget.module.min.js"
  async
  defer
></script>

<script nomodule src="https://cdn.jsdelivr.net/npm/friendly-challenge@0.9.16/widget.min.js" async defer></script>

<noscript>
  <link rel="stylesheet" href="{{ relURL "noscript_smooth.css" }}" crossorigin="anonymous">
</noscript>

<script>

  var inputs = document.getElementsByTagName('input');
  for(let i=0; i<inputs.length; i++){
      if(inputs[i].type === "checkbox"){continue};
      inputs[i].setAttribute('size',inputs[i].getAttribute('placeholder').length);
  }

  if (localStorage.getItem('theme') == 'dark') {
    document.querySelector('.frc-captcha').classList.add("dark");
  }

  document.addEventListener('DOMContentLoaded', () => {

    document.querySelectorAll('a[href="#send-us-directly-your-files-open_file_folder"]').forEach((a) => a.addEventListener("click", (e) => {
      e.preventDefault();
      document.documentElement.style.scrollBehavior = "smooth";
      const y = document.getElementById("send-us-directly-your-files-open_file_folder").offsetTop;
      const offset = document.querySelector(".sticky-header").offsetHeight;
      window.scrollTo({top:y-offset-10, behavior:"smooth"});
      window.location.hash = "#send-us-directly-your-files-open_file_folder";
    }))

    var timeout = null;
    var form = document.getElementById("form");
    var status = document.getElementById("my-form-status");
    status.innerText = "0";
    
    async function handleSubmit(event) {

      event.preventDefault();
      status.classList.remove("arrived");
      if(timeout !== null) window.clearTimeout(timeout);

      const loader = document.querySelector("#loading");
      loader.classList.add("display");

      var data = new FormData(event.target);
      var text_msg = "";
      var text_color = "";

      fetch(event.target.action, {
        method: form.method,
        body: data,
        headers: {
            'Accept': 'application/json',
        }

      }).then(response => {
        if (response.ok) {

          text_msg = "Thanks for your submission! 📨";
          text_color = "#119f07";
          form.reset();
          friendlyChallenge.autoWidget.reset();

        } else {

          response.json().then(data => {

            if (Object.hasOwn(data, 'errors')) {

              text_msg = data["errors"].map(error => error["message"]).join(", ");
              text_color = '#d07';

            } else {

              text_msg = "Oops! Wrong response received, maybe not submitted.";
              text_color = '#d50';

            }
          })

          friendlyChallenge.autoWidget.reset();

        }
      }).catch(error => {

        text_msg = "Oops! There was an error while fetching the API. ❌";
        text_color = '#c83232';

      });
      
      setTimeout(() => {loader.classList.remove("display");}, 2200);
      setTimeout(() => {
        status.innerText = text_msg;
        status.style.color = text_color;
        status.classList.add("arrived");
      }, 2800);
      timeout = window.setTimeout(() => {status.classList.remove("arrived");}, 10000);
    }

    var host = window.location.host;
    var span_it = document.getElementById("alternative-it");
    var span_en = document.getElementById("alternative-en");

    if (host.includes("netlify")) {
      span_it.innerHTML = `Se incontri dei problemi con l'attuale sito prova sulla <a href="https://valerionew.github.io/triennale-elettronica-polimi/">Github Page</a>.`;
      span_en.innerHTML = `If you encounter any problem with the current website you can try the <a href="https://valerionew.github.io/triennale-elettronica-polimi/">Github Page</a>.`;
    } else if (host.includes("github")) {
      span_it.innerHTML = `Se incontri dei problemi con l'attuale sito prova sul <a href="https://triennale-elettronica-polimi.netlify.app/">Netlify Mirror</a>.`;
      span_en.innerHTML = `If you encounter any problem with the current website you can try the <a href="https://triennale-elettronica-polimi.netlify.app/">Netlify Mirror</a>.`;
    }

    form.addEventListener("submit", handleSubmit);

    var toggle = document.querySelector("#toggle").addEventListener("change", () => {
      if (localStorage.getItem('theme') === 'dark') {
        document.querySelector('.frc-captcha').classList.add("dark");
      } else {
        document.querySelector('.frc-captcha').classList.remove("dark");
      }
    }, false);

  })

</script>

<noscript>
  <p style="text-align: center;font-size: large;"><b style="color: red;">!! You need Javascript for CAPTCHA verification to submit this form !!</b></p>
</noscript>
